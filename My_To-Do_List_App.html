<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Stylish To-Do List — Fixed</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #fff8f6;
      --card: #ffffff;
      --muted: #6b7280;
      --accent-from: #ff7aa2;
      --accent-to: #ffb199;
      --radius: 14px;
      --shadow: 0 8px 24px rgba(15,23,42,0.08);
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Poppins',system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background: linear-gradient(180deg,#fff 0%, #fff8f6 100%);
      display:flex; align-items:center; justify-content:center;
      padding:28px;
      color:#0f172a;
    }

    .container{
      width:100%; max-width:460px;
      background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.94));
      border-radius:18px;
      box-shadow:var(--shadow);
      overflow:hidden;
      border:1px solid rgba(15,23,42,0.04);
    }

    header{
      padding:20px 20px;
      background:linear-gradient(90deg,var(--accent-from),var(--accent-to));
      color:white;
    }
    header h1{margin:0;font-size:20px;letter-spacing:0.2px}
    header p{margin:6px 0 0;font-size:13px;opacity:0.95}

    .composer{
      display:flex;
      gap:10px;
      padding:16px;
      align-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.4));
    }
    .composer input{
      flex:1;
      padding:12px 14px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,0.06);
      font-size:15px;
      outline:none;
      box-shadow: 0 4px 10px rgba(2,6,23,0.03) inset;
    }
    .composer button{
      padding:10px 14px;
      border-radius:12px;
      border:0;
      background:linear-gradient(180deg,#fff,#ffeef0);
      color:#111827;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(255,122,162,0.12);
    }
    .composer button:active{transform:translateY(1px)}

    .list-wrap{padding:10px 16px 6px}
    ul#tasks{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:10px}
    li.task-item{
      display:flex; align-items:center; gap:12px;
      padding:12px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,0.04);
      background: linear-gradient(180deg, rgba(250,250,250,0.75), rgba(255,255,255,0.6));
      transition:transform .12s ease, box-shadow .12s;
    }
    li.task-item:hover{transform:translateY(-4px); box-shadow: 0 10px 24px rgba(2,6,23,0.06)}
    li.task-item input[type="checkbox"]{width:18px;height:18px;border-radius:4px;cursor:pointer}
    .task-text{flex:1;font-weight:600; font-size:15px; color: #0f172a}
    .task-meta{font-size:12px;color:var(--muted);margin-top:4px;font-weight:500}
    li.task-item.completed .task-text{ text-decoration:line-through; opacity:0.6; font-weight:600 }

    .task-actions{display:flex; gap:8px; align-items:center}
    .btn-small{
      width:36px;height:36px;border-radius:10px;border:1px solid rgba(15,23,42,0.04);
      display:grid;place-items:center;background:transparent;cursor:pointer;font-size:16px;
    }
    .btn-small.del{color:#ef4444}
    .btn-small.edit{color:#0ea5e9}

    .filters{display:flex;gap:8px;padding:12px 16px;border-top:1px solid rgba(15,23,42,0.03);align-items:center;justify-content:space-between}
    .filters .group{display:flex;gap:8px}
    .filter-btn{
      padding:8px 12px;border-radius:999px;border:1px solid rgba(15,23,42,0.04);background:transparent;cursor:pointer;font-weight:600
    }
    .filter-btn.active{background:linear-gradient(90deg,var(--accent-from),var(--accent-to));color:white;border:0;box-shadow:0 6px 20px rgba(255,122,162,0.12)}

    .counts{font-size:13px;color:var(--muted);font-weight:600}

    /* small edit input style */
    .edit-input{
      font-size:15px;padding:8px 10px;border-radius:8px;border:1px solid rgba(15,23,42,0.06);flex:1;
    }

    @media (max-width:420px){
      .composer{padding:12px}
      header h1{font-size:18px}
    }
  </style>
</head>
<body>
  <div class="container" role="application" aria-label="To-Do list">
    <header>
      <h1>Lovely To-Do</h1>
      <p>Type a task and press Add or Enter — double-click to edit</p>
    </header>

    <div class="composer" aria-label="Add task area">
      <input id="taskInput" type="text" placeholder="Add a new task..." aria-label="New task">
      <button id="addBtn" aria-label="Add task">Add</button>
    </div>

    <div class="list-wrap">
      <ul id="tasks" aria-live="polite"></ul>
    </div>

    <div class="filters">
      <div class="group" role="tablist" aria-label="Filters">
        <button class="filter-btn" data-filter="All">All</button>
        <button class="filter-btn" data-filter="Active">Active</button>
        <button class="filter-btn" data-filter="Completed">Completed</button>
      </div>
      <div class="counts" id="counts">0 items • 0 completed</div>
    </div>
  </div>

  <script>
    (function(){
      // Refs
      const input = document.getElementById('taskInput');
      const addBtn = document.getElementById('addBtn');
      const tasksUl = document.getElementById('tasks');
      const filterBtns = Array.from(document.querySelectorAll('.filter-btn'));
      const counts = document.getElementById('counts');

      // State & persistence keys
      const STORAGE_KEY = 'stylishTodo.tasks.v1';
      const FILTER_KEY  = 'stylishTodo.filter.v1';

      let tasks = [];
      let filter = localStorage.getItem(FILTER_KEY) || 'All';

      // load
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) tasks = JSON.parse(raw);
      } catch (e) {
        tasks = [];
      }

      // Helper: persist
      function save(){
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks)); } catch(e){}
        try { localStorage.setItem(FILTER_KEY, filter); } catch(e){}
      }

      // Render UI
      function render(){
        tasksUl.innerHTML = '';
        tasks.forEach((task, idx) => {
          // filter
          if (filter === 'Active' && task.done) return;
          if (filter === 'Completed' && !task.done) return;

          const li = document.createElement('li');
          li.className = 'task-item' + (task.done ? ' completed' : '');
          li.setAttribute('data-index', idx);

          const chk = document.createElement('input');
          chk.type = 'checkbox';
          chk.checked = !!task.done;
          chk.addEventListener('change', () => {
            tasks[idx].done = chk.checked;
            save();
            render();
          });

          const content = document.createElement('div');
          content.style.display = 'flex';
          content.style.flexDirection = 'column';
          content.style.flex = '1';

          const span = document.createElement('span');
          span.className = 'task-text';
          span.textContent = task.text;
          // double click to edit
          span.addEventListener('dblclick', () => openEdit(idx));

          const meta = document.createElement('span');
          meta.className = 'task-meta';
          const d = new Date(task.createdAt || Date.now());
          meta.textContent = 'Added ' + d.toLocaleString();

          content.appendChild(span);
          content.appendChild(meta);

          // actions
          const actions = document.createElement('div');
          actions.className = 'task-actions';

          const editBtn = document.createElement('button');
          editBtn.className = 'btn-small edit';
          editBtn.type = 'button';
          editBtn.title = 'Edit';
          editBtn.textContent = '✏';
          editBtn.addEventListener('click', () => openEdit(idx));

          const delBtn = document.createElement('button');
          delBtn.className = 'btn-small del';
          delBtn.type = 'button';
          delBtn.title = 'Delete';
          delBtn.textContent = '✕';
          delBtn.addEventListener('click', () => {
            tasks.splice(idx, 1);
            save();
            render();
          });

          actions.appendChild(editBtn);
          actions.appendChild(delBtn);

          li.appendChild(chk);
          li.appendChild(content);
          li.appendChild(actions);

          tasksUl.appendChild(li);
        });

        // update filter buttons state
        filterBtns.forEach(b => {
          b.classList.toggle('active', b.dataset.filter === filter);
        });

        // counts
        const total = tasks.length;
        const done = tasks.filter(t => t.done).length;
        counts.textContent = `${total} items • ${done} completed`;
      }

      // add task
      function addTask(){
        const text = input.value.trim();
        if (!text) {
          input.focus();
          return;
        }
        tasks.push({ text, done: false, createdAt: Date.now() });
        input.value = '';
        save();
        render();
        input.focus();
      }

      // edit task in place
      function openEdit(idx){
        const li = tasksUl.querySelector(`li[data-index="${idx}"]`);
        if (!li) return;
        const textDiv = li.querySelector('.task-text');
        // create edit input
        const editInput = document.createElement('input');
        editInput.type = 'text';
        editInput.className = 'edit-input';
        editInput.value = tasks[idx].text;
        // replace text span with input
        textDiv.replaceWith(editInput);
        editInput.focus();
        editInput.select();

        function finish(){
          const val = editInput.value.trim();
          if (val) tasks[idx].text = val;
          save();
          render();
        }
        editInput.addEventListener('blur', finish, { once: true });
        editInput.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            finish();
          } else if (e.key === 'Escape') {
            render();
          }
        });
      }

      // events
      addBtn.addEventListener('click', addTask);
      input.addEventListener('keydown', (e) => { if (e.key === 'Enter') addTask(); });

      filterBtns.forEach(b => {
        b.addEventListener('click', () => {
          filter = b.dataset.filter;
          save();
          render();
        });
      });

      // initial render
      render();
    })();
  </script>
</body>
</html>
